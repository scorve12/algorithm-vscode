"""
[로봇 청소기] - 구현 + 시뮬레이션

문제 설명:
N×M 격자에서 로봇 청소기가 다음 규칙으로 작동합니다:
1. 현재 칸이 청소되지 않았으면 청소한다.
2. 주변 4칸 중 청소되지 않은 빈 칸이 있으면:
   - 반시계 방향으로 90도 회전
   - 앞쪽 칸이 청소되지 않은 빈 칸이면 전진
3. 주변 4칸 모두 청소되었거나 벽이면:
   - 뒤로 한 칸 후진 (방향 유지)
   - 후진 불가능하면 작동 정지

방향: 0=북, 1=동, 2=남, 3=서
로봇이 청소하는 칸의 수를 구하세요.

제한사항:
- 3 ≤ N, M ≤ 50
- 0: 빈 칸, 1: 벽

입출력 예:
N=3, M=3, r=1, c=1, d=0
board=[[1,1,1],[1,0,1],[1,1,1]] → 1

N=11, M=10, r=7, c=4, d=0
(아래 테스트 참조) → 57
"""


def solution(n, m, r, c, d, board):
    # 북, 동, 남, 서
    dr = [-1, 0, 1, 0]
    dc = [0, 1, 0, -1]

    cleaned = 0
    visited = [[False] * m for _ in range(n)]

    while True:
        # 1. 현재 칸 청소
        if not visited[r][c]:
            visited[r][c] = True
            cleaned += 1

        # 2. 주변 4칸 확인
        found = False
        for _ in range(4):
            d = (d + 3) % 4  # 반시계 방향 회전
            nr, nc = r + dr[d], c + dc[d]
            if 0 <= nr < n and 0 <= nc < m and board[nr][nc] == 0 and not visited[nr][nc]:
                r, c = nr, nc
                found = True
                break

        if not found:
            # 3. 후진 시도
            br, bc = r - dr[d], c - dc[d]
            if 0 <= br < n and 0 <= bc < m and board[br][bc] == 0:
                r, c = br, bc
            else:
                break  # 작동 정지

    return cleaned


# 테스트 1
assert solution(3, 3, 1, 1, 0, [
    [1, 1, 1],
    [1, 0, 1],
    [1, 1, 1],
]) == 1

# 테스트 2
board2 = [
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 0, 1, 1, 1, 1, 0, 1],
    [1, 0, 0, 1, 1, 0, 0, 0, 0, 1],
    [1, 0, 1, 1, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 1, 0, 1],
    [1, 0, 0, 0, 0, 0, 1, 1, 0, 1],
    [1, 0, 0, 0, 0, 0, 1, 1, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
]
assert solution(11, 10, 7, 4, 0, board2) == 57
print("로봇 청소기: 모든 테스트 통과!")
